<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Upload to S3</title>
    </head>
    <body>
        <h2>Upload a File</h2>
        <form id="uploadForm">
            <input type="file" id="fileInput" name="file" style="display: block; margin: 20px;"/>
            <button type="submit" style="display: block; margin: 20px;">Upload</button>
        </form>
        <p id="status"></p>
        <p id="link"></p>
        <script>
        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById("fileInput");
            if (!fileInput.files.length) {
                alert("Please select a file first!");
                return;
            }
            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            document.getElementById("status").textContent = "Uploading...";

            try {
                const res = await fetch("/upload", {
                    method: "POST",
                    body: formData,
                });

                if (!res.ok) {
                    const errorText = await res.text();
                    throw new Error(errorText || `Upload failed with status ${res.status}`);
                }

                const data = await res.json();
                document.getElementById("status").textContent = "✅ Upload successful!";
                document.getElementById("link").innerHTML = `
                <p>
                    <a href="${data.url}" target="_blank">View via Signed URL</a>
                </p>
                <p>
                    <a href="/files/${data.key}" target="_blank">View via App Route</a>
                </p>`;
            } catch (err) {
                document.getElementById("status").textContent = "❌ Upload failed: " + err;
                document.getElementById("link").innerHTML = "";
            }
        });
        </script>
    </body>
</html>
